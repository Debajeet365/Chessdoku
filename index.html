<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chess-Sudoku Game</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 20px;
    }
    #board {
      display: grid;
      grid-template-columns: repeat(8, 40px);
      grid-template-rows: repeat(8, 40px);
      gap: 2px;
    }
    .cell {
      width: 40px;
      height: 40px;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      cursor: pointer;
      border: 1px solid #ccc;
    }
    .black { background-color: #d18b47; color: black; }
    .white { background-color: #ffce9e; color: white; }
    .selected { border: 2px solid red; }
    select, button {
      margin: 10px;
      padding: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Chess-Sudoku Game</h1>
  <div>
    <label for="piece">Select Piece:</label>
    <select id="piece">
      <option value="K">King</option>
      <option value="Q">Queen</option>
      <option value="R">Rook</option>
      <option value="B">Bishop</option>
      <option value="N">Knight</option>
      <option value="P">Pawn</option>
    </select>
    <button onclick="surrender()">End Game</button>
    <button onclick="resetGame()">Restart Game</button>
  </div>
  <div id="board"></div>
  <p id="status"></p>

  <script>
    const board = document.getElementById("board");
    const status = document.getElementById("status");
    const pieceSelector = document.getElementById("piece");

    const pieceLimits = {
      K: 1,
      Q: 1,
      R: 2,
      B: 2,
      N: 2,
      P: Infinity,
    };

    const pieceSymbols = {
      K: "♔",
      Q: "♕",
      R: "♖",
      B: "♗",
      N: "♘",
      P: "♙",
    };

    let currentPlayer = 1;
    let boardState = Array(8).fill(null).map(() => Array(8).fill(null));
    let playerCounts = [
      {},
      { K: 0, Q: 0, R: 0, B: 0, N: 0, P: 0 },
      { K: 0, Q: 0, R: 0, B: 0, N: 0, P: 0 },
    ];
    let piecesPlaced = [0, 0];

    function createBoard() {
      board.innerHTML = "";
      for (let row = 0; row < 8; row++) {
        for (let col = 0; col < 8; col++) {
          const cell = document.createElement("div");
          cell.classList.add("cell");
          cell.dataset.row = row;
          cell.dataset.col = col;
          cell.onclick = () => placePiece(row, col);
          board.appendChild(cell);
        }
      }
    }

    function isValid(row, col, piece) {
      for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
          const p = boardState[r][c];
          if (p && p.player !== currentPlayer) {
            const dr = Math.abs(r - row);
            const dc = Math.abs(c - col);
            if (
              (p.piece === "Q" && (dr === dc || r === row || c === col)) ||
              (p.piece === "R" && (r === row || c === col)) ||
              (p.piece === "B" && dr === dc) ||
              (p.piece === "N" && dr + dc === 3 && dr !== 0 && dc !== 0) ||
              (p.piece === "K" && dr <= 1 && dc <= 1)
            ) {
              return false;
            }
          }
        }
      }
      return true;
    }

    function placePiece(row, col) {
      const piece = pieceSelector.value;
      if (boardState[row][col]) {
        alert("This square is already occupied.");
        return;
      }
      if (piece === "P" && piecesPlaced[0] + piecesPlaced[1] < 16) {
        alert("Pawns can only be placed after 16 pieces are on the board.");
        return;
      }
      if (playerCounts[currentPlayer][piece] >= pieceLimits[piece]) {
        alert(`Only ${pieceLimits[piece]} ${piece} piece(s) allowed.`);
        return;
      }
      if (!isValid(row, col, piece)) {
        alert("Reserved: Cannot place piece in a threatened square.");
        return;
      }

      boardState[row][col] = { piece, player: currentPlayer };
      playerCounts[currentPlayer][piece]++;
      piecesPlaced[currentPlayer - 1]++;

      const symbol = pieceSymbols[piece];
      const cell = board.querySelector(
        `.cell[data-row='${row}'][data-col='${col}']`
      );
      cell.textContent = symbol;
      cell.classList.add(currentPlayer === 1 ? "white" : "black");

      checkWin();
      currentPlayer = 3 - currentPlayer;
      status.textContent = `Player ${currentPlayer}'s Turn`;
    }

    function checkWin() {
      if (piecesPlaced[0] === 8) {
        status.textContent = "Player 1 Wins!";
        disableBoard();
      } else if (piecesPlaced[1] === 8) {
        status.textContent = "Player 2 Wins!";
        disableBoard();
      } else if (piecesPlaced[0] + piecesPlaced[1] === 64) {
        if (piecesPlaced[0] > piecesPlaced[1]) {
          status.textContent = "Player 1 Wins!";
        } else if (piecesPlaced[1] > piecesPlaced[0]) {
          status.textContent = "Player 2 Wins!";
        } else {
          status.textContent = "Draw!";
        }
        disableBoard();
      }
    }

    function disableBoard() {
      const cells = board.querySelectorAll(".cell");
      cells.forEach(cell => (cell.onclick = null));
    }

    function surrender() {
      if (confirm("Are you sure you want to surrender and end the game?")) {
        status.textContent = `Player ${currentPlayer} surrendered. Player ${3 - currentPlayer} Wins!`;
        disableBoard();
      }
    }

    function resetGame() {
      boardState = Array(8).fill(null).map(() => Array(8).fill(null));
      playerCounts = [
        {},
        { K: 0, Q: 0, R: 0, B: 0, N: 0, P: 0 },
        { K: 0, Q: 0, R: 0, B: 0, N: 0, P: 0 },
      ];
      piecesPlaced = [0, 0];
      currentPlayer = 1;
      status.textContent = "Player 1's Turn";
      createBoard();
    }

    createBoard();
    status.textContent = "Player 1's Turn";
  </script>
</body>
</html>
